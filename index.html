<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Vendas e Comiss√£o</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî¥ COLE AQUI SEU firebaseConfig */
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_PROJETO.firebaseapp.com",
  projectId: "SEU_PROJETO",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* üîê LOGIN */
window.login = async () => {
  const email = emailInput.value;
  const senha = senhaInput.value;

  try {
    await signInWithEmailAndPassword(auth, email, senha);
  } catch {
    await createUserWithEmailAndPassword(auth, email, senha);
  }
};

/* üîÑ ESTADO */
onAuthStateChanged(auth, user => {
  if (user) {
    loginDiv.style.display = "none";
    sistema.style.display = "block";
    carregar();
  }
});

/* üì• CARREGAR */
async function carregar() {
  lista.innerHTML = "";
  totalVendido.innerText = "0";
  totalComissao.innerText = "0";

  const ref = collection(db, "usuarios", auth.currentUser.uid, "vendas");
  const snap = await getDocs(ref);

  let total = 0;
  let comissao = 0;
  const perc = +percentual.value || 0;

  snap.forEach(d => {
    const v = d.data();
    if (v.mes === mes.value && v.ano == ano.value) {
      const c = v.valor * (perc / 100);
      total += v.valor;
      comissao += c;

      lista.innerHTML += `
        <tr>
          <td>${v.cliente}</td>
          <td>R$ ${v.valor.toFixed(2)}</td>
          <td>${perc}%</td>
          <td>R$ ${c.toFixed(2)}</td>
          <td><button onclick="excluir('${d.id}')">Excluir</button></td>
        </tr>`;
    }
  });

  totalVendido.innerText = total.toFixed(2);
  totalComissao.innerText = comissao.toFixed(2);
}

/* ‚ûï ADD */
window.adicionar = async () => {
  await addDoc(collection(db, "usuarios", auth.currentUser.uid, "vendas"), {
    cliente: cliente.value,
    valor: +valor.value,
    mes: mes.value,
    ano: ano.value
  });
  carregar();
};

/* ‚ùå EXCLUIR */
window.excluir = async (id) => {
  await deleteDoc(doc(db, "usuarios", auth.currentUser.uid, "vendas", id));
  carregar();
};

window.atualizar = carregar;
</script>

<style>
body { font-family: Arial; background: #f2f2f2; padding: 20px; }
.container { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; }
input, select, button { width: 100%; padding: 10px; margin: 5px 0; }
button { background: #007bff; color: #fff; border: none; border-radius: 5px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
th { background: #007bff; color: white; }
</style>
</head>

<body>

<div class="container" id="loginDiv">
<h2>Login</h2>
<input id="emailInput" placeholder="Email">
<input id="senhaInput" type="password" placeholder="Senha">
<button onclick="login()">Entrar / Criar Conta</button>
</div>

<div class="container" id="sistema" style="display:none">
<h1>Controle de Vendas & Comiss√£o</h1>

<input id="percentual" type="number" placeholder="Comiss√£o (%)">

<select id="mes" onchange="atualizar()">
  <option value="01">Janeiro</option>
  <option value="02">Fevereiro</option>
  <option value="03">Mar√ßo</option>
</select>

<input id="ano" type="number" value="2026" onchange="atualizar()">

<input id="cliente" placeholder="Cliente">
<input id="valor" type="number" placeholder="Valor da venda">
<button onclick="adicionar()">Adicionar Venda</button>

<h3>Total Vendido: R$ <span id="totalVendido">0</span></h3>
<h3>Total Comiss√£o: R$ <span id="totalComissao">0</span></h3>

<table>
<thead>
<tr><th>Cliente</th><th>Venda</th><th>%</th><th>Comiss√£o</th><th>A√ß√£o</th></tr>
</thead>
<tbody id="lista"></tbody>
</table>
</div>

</body>
</html>
